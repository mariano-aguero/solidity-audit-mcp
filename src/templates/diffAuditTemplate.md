## :mag: Diff Audit Report

<div align="center">

<img src="https://img.shields.io/badge/Changes-{{totalChanges}}-blue?style=for-the-badge" alt="Changes" />
<img src="https://img.shields.io/badge/Risk-{{riskLevel}}-{{riskColor}}?style=for-the-badge" alt="Risk Level" />
{{#if newFindings}}<img src="https://img.shields.io/badge/New_Issues-{{newFindings}}-{{newIssuesColor}}?style=for-the-badge" alt="New Issues" />{{/if}}
{{#if resolvedFindings}}<img src="https://img.shields.io/badge/Resolved-{{resolvedFindings}}-success?style=for-the-badge" alt="Resolved" />{{/if}}

</div>

---

### Change Summary

<table>
<tr>
<td align="center" width="25%">
<h3>{{linesAdded}}</h3>
<sub>:heavy_plus_sign: Lines Added</sub>
</td>
<td align="center" width="25%">
<h3>{{linesRemoved}}</h3>
<sub>:heavy_minus_sign: Lines Removed</sub>
</td>
<td align="center" width="25%">
<h3>{{functionsChanged}}</h3>
<sub>:wrench: Functions Changed</sub>
</td>
<td align="center" width="25%">
<h3>{{newFindings}}</h3>
<sub>:warning: New Issues</sub>
</td>
</tr>
</table>

---

### Risk Assessment

{{#if isHighRisk}}
> [!CAUTION]
> **High Risk Changes Detected** — This diff introduces significant modifications that require careful review.
{{else if isMediumRisk}}
> [!WARNING]
> **Moderate Risk** — Review the changes below for potential security implications.
{{else}}
> [!TIP]
> **Low Risk** — Changes appear minimal with no new security concerns.
{{/if}}

| Risk Factor | Status | Notes |
|:------------|:------:|:------|
| New External Calls | {{#if hasNewExternalCalls}}:warning: Yes{{else}}:white_check_mark: No{{/if}} | {{#if hasNewExternalCalls}}Check for reentrancy{{/if}} |
| Modified Access Control | {{#if hasAccessControlChanges}}:warning: Yes{{else}}:white_check_mark: No{{/if}} | {{#if hasAccessControlChanges}}Review permissions{{/if}} |
| Changed State Variables | {{#if hasStateChanges}}:large_blue_circle: Yes{{else}}:white_check_mark: No{{/if}} | {{#if hasStateChanges}}Verify storage layout{{/if}} |
| New Assembly Usage | {{#if hasNewAssembly}}:warning: Yes{{else}}:white_check_mark: No{{/if}} | {{#if hasNewAssembly}}Manual review required{{/if}} |
| Modified Financial Logic | {{#if hasFinancialChanges}}:rotating_light: Yes{{else}}:white_check_mark: No{{/if}} | {{#if hasFinancialChanges}}Critical review needed{{/if}} |

---

{{#if newIssues}}
### :new: New Issues Introduced

{{#each newIssues}}
<details {{#if isCriticalOrHigh}}open{{/if}}>
<summary>{{severityEmoji}} <strong>{{title}}</strong> — <code>{{location.file}}:{{location.line}}</code></summary>

{{description}}

{{#if recommendation}}
> **Recommendation:** {{recommendation}}
{{/if}}

{{#if codeSnippet}}
```solidity
{{codeSnippet}}
```
{{/if}}

</details>
{{/each}}

---
{{/if}}

{{#if resolvedIssues}}
### :white_check_mark: Resolved Issues

These issues from the previous version have been addressed:

{{#each resolvedIssues}}
- ~~{{title}}~~ — Previously at `{{location.file}}:{{location.line}}`
{{/each}}

---
{{/if}}

{{#if unchangedIssues}}
### :hourglass: Existing Issues (Unchanged)

The following issues from the previous version still exist:

| Severity | Issue | Location |
|:--------:|:------|:---------|
{{#each unchangedIssues}}
| {{severityEmoji}} | {{title}} | `{{location.file}}:{{location.line}}` |
{{/each}}

---
{{/if}}

### Changed Functions

<details>
<summary><strong>:wrench: Modified Functions ({{changedFunctions.length}})</strong></summary>

| Function | Change Type | Risk |
|:---------|:------------|:----:|
{{#each changedFunctions}}
| `{{name}}()` | {{changeType}} | {{riskIndicator}} |
{{/each}}

</details>

{{#if newFunctions}}
<details>
<summary><strong>:sparkles: New Functions ({{newFunctions.length}})</strong></summary>

| Function | Visibility | Modifiers |
|:---------|:-----------|:----------|
{{#each newFunctions}}
| `{{name}}()` | {{visibility}} | {{modifiers}} |
{{/each}}

</details>
{{/if}}

{{#if removedFunctions}}
<details>
<summary><strong>:wastebasket: Removed Functions ({{removedFunctions.length}})</strong></summary>

{{#each removedFunctions}}
- `{{name}}()`
{{/each}}

</details>
{{/if}}

---

### Diff Details

<details>
<summary><strong>:page_facing_up: Full Diff</strong></summary>

```diff
{{diffContent}}
```

</details>

---

<details>
<summary>:gear: <strong>Analysis Information</strong></summary>

| Property | Value |
|:---------|:------|
| **Old Version** | `{{oldVersion}}` |
| **New Version** | `{{newVersion}}` |
| **Analysis Date** | {{timestamp}} |
| **Focus Mode** | {{#if focusOnly}}Changes Only{{else}}Full Contract{{/if}} |

</details>

---

<sub>

:robot: Generated by **[MCP Audit Server](https://github.com/mcp-audit-server)**

</sub>
